MM Bot (Bybit Spot) — Deterministic Structure-Driven Market Making
О проекте
Это детерминированный торговый движок,который реализует структуру:
Market Data → Structure → BOS → Pullback → Policy → State Machine → MM Grid
Система:
- работает без плечей и без шорта- торгует только spot- держит капитал преимущественно в USDT- входит в рынок только после подтверждённого BOS- после входа запускает адаптивный market making- полностью детерминирована и воспроизводима
Главная цель проекта:
«Построить стабильную проп-десковую MM-системус контролируемым риском и повторяемым результатом.»
---
Архитектура
Принцип разделения
Система строго разделена на слои:
1. Bybit (внешний мир)
- WebSocket market data- REST исторические данные- не знает о стратегии
2. Engine (мозг)
- CandleFeed- ATR- Structure detection- BOS / Pullback- Policy- State machine- MM grid decision
3. Execution (будущее)
- ордера- комиссии- исполнение- риск-менеджмент
Сейчас реализованы первые два уровня→ это уже полноценный исследовательский проп-движок.
---
Текущий статус
Реализовано
Data
- Bybit WS:  - "kline.5"  - "ticker"- Bybit REST:  - загрузка исторических свечей  - автопагинация диапазона  - CSV-кэш
Structure
- ATR- Pivot-based structure- BOS:  - Potential  - Confirmed- Pullback detection
Decision
- Policy:  - Disabled  - Normal  - Defensive- State machine:  - Idle → BOS → Rebalance → MM → Exit- Grid:  - адаптивный размер  - soft/hard inventory bands
Tooling
- Live engine loop- Deterministic backtest runner- CSV cache- CLI параметры диапазона
---
Что это означает фактически
Система уже умеет:
- видеть структуру рынка- ждать подтверждения- не входить случайно- включать MM только по форме- воспроизводимо тестироваться на истории
Это критический рубежмежду:
"бот-игрушка"и"исследовательская торговая система"
---
Как запустить
Live engine (без ордеров)
cargo run -p engine
Показывает:
- приход свечей- BOS / pullback- решения policy- включение MM-режима
---
Backtest
cargo run -p engine --bin backtest -- \  --symbol ETHUSDT \  --interval 5 \  --start 2026-01-01 \  --end 2026-02-01 \  --cache data/eth_5m.csv
Функции:
- автозагрузка Bybit- CSV-кэш- детерминированный прогон- события policy / transitions
---
Orchestration Foundation (API + Worker)
Добавлены два сервиса для управления backtest/sweep заданиями:
- `api` (Axum + SQLx + PostgreSQL + Redis queue)
- `worker` (очередь Redis, выполнение `cargo run -p engine --bin ...`)

Требуемые переменные окружения:
- `DATABASE_URL` (PostgreSQL)
- `REDIS_URL` (Redis)
- `BIND_ADDR` (опционально, по умолчанию `0.0.0.0:8080`) для API
- `WORKSPACE_ROOT` (опционально, путь к репозиторию) для worker

Запуск API:
`cargo run -p api`

Запуск Worker:
`cargo run -p worker`

Локальный запуск всей orchestration-связки (api + worker + postgres + redis):
`docker compose -f docker-compose.orchestrator.yml up`

Деплой на Railway:
см. `RAILWAY.md`.

Базовые endpoints API:
- `GET /health`
- `POST /runs`
- `POST /runs/presets/mm_mtf_sweep`
- `GET /runs`
- `GET /runs/:id`
- `GET /runs/:id/events`
- `GET /runs/:id/metrics`
- `GET /runs/:id/artifacts`

Пример `POST /runs`:
```json
{
  "name": "MM MTF Jan-Feb",
  "kind": "backtest_mm_mtf",
  "cli_args": [
    "--symbol", "ETHUSDT",
    "--htf-interval", "5",
    "--ltf-interval", "1",
    "--start", "2026-01-01",
    "--end", "2026-02-10"
  ]
}
```
---
Ограничения текущей версии
Backtest ещё не учитывает:
- комиссии- спред- очередь в стакане- частичные исполнения- latency- ликвидность
Это нормально.Сейчас тестируется форма логики, а не деньги.
---
Дорожная карта до прибыли
Этап 1 — Логическая валидность (почти завершён)
Цель:
«Стратегия имеет форму на истории.»
Задачи:
- стабильный backtest- статистика BOS / MM- время в режиме Disabled- частота Defensive
---
Этап 2 — Реалистичный симулятор исполнения
Добавить:
- fee model- spread model- partial fills- очередь ордербука- slippage
Результат:
«Честный PnL backtest»
Это первый настоящий фильтр.
---
Этап 3 — Paper trading (реальное время, без денег)
Подключить:
- реальные балансы- реальные ордера → но cancel-only / sandbox- лог PnL в реальном времени
Цель:
«Проверка устойчивости во времени,а не только на истории.»
---
Этап 4 — Малый капитал
Принципы:
- минимальный депозит- лимит дневного убытка- kill-switch- мониторинг latency
Цель:
«Проверить совпадает ли реальность с симуляцией.»
---
Этап 5 — Проп-режим
Только если:
- backtest прибыльный- paper стабилен- малый капитал не деградирует
Тогда:
- увеличение размера- многопарный MM- портфельная аллокация- риск на уровне системы
---
Критерий успеха
Проект считается успешным, если:
Backtest (с комиссиями)→ Paper (1-2 месяца)→ Small capital (без деградации)→ Scale
И только в таком порядке.
---
Главный принцип системы
Не “угадывать рынок”.
А:
«Входить только когда рынок уже показал форму.И зарабатывать на микродвижении после подтверждения.»
Это и есть:
Structure-Driven Market Making
---
Следующий шаг разработки
Технически самый важный следующий этап:
➜ Реалистичный execution-симулятор
Без него:
- любой MM кажется прибыльным- но это иллюзия
С ним:
- станет ясно  есть ли реальная альфа.
---
Авторский замысел системы
Это не просто бот.
Это попытка построить:
«строгую, телесную, детерминированную форму работы с рынком,где решение рождается не из эмоции,а из структуры.»
---
Лицензия
Пока внутренняя разработка.
---
Финальная мысль
Если система:
- детерминирована- воспроизводима- проверяема- проходит этапы без прыжков
то она может стать:
«реальным проп-инструментом,а не очередной стратегией из интернета.»
